<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clay County News & Events Hub</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Georgia&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.10/index.global.min.js"></script>

    <style>
        /* --- 1. GLOBAL PAGE SAFETY (Divi Compatibility) --- */
        .et_pb_row, .et_pb_column, .et_pb_module {
            position: relative; top: auto; bottom: auto; transform: none; 
            box-sizing: border-box; display: block;
        }

        /* --- 2. HEADER PROTECTION (Desktop) --- */
        @media (min-width: 981px) {
            #main-header .et_pb_row {
                display: flex !important; flex-direction: row !important;
                align-items: center !important; justify-content: space-between !important;
                width: 100% !important; max-width: 100% !important;
            }
            #main-header .et_pb_column { display: flex !important; justify-content: center !important; flex: 1 !important; }
        }

        /* --- 3. MOBILE & ULTRAWIDE SAFETY --- */
        @media (max-width: 980px) { #main-header .et_pb_row { flex-direction: column !important; } }
        @media (min-width: 1600px) { .et_pb_row { max-width: 1440px !important; margin: 0 auto !important; } }

        /* --- 4. GLOBAL THEME --- */
        body { margin: 0; background: #f4f4f4; font-family: 'Playfair Display', serif; color: #1a1a1a; overflow-x: hidden; }
        .main-hub-container { max-width: 1100px; margin: 0 auto; padding: 20px; }

        /* --- 5. MENU BAR (Separated Section) --- */
        .menu-wrapper { background: #fff; padding: 20px 0; border-bottom: 2px solid #eee; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .city-nav { list-style: none; display: flex; gap: 15px; margin: 0; padding: 0; flex-wrap: wrap; justify-content: center; }
        .city-nav li a { text-decoration: none; font-weight: bold; font-family: sans-serif; padding: 10px 18px; border-radius: 8px; font-size: 0.9rem; color: #fff; }
        
        .btn-claycity a { background: #0c30f0; }
        .btn-sailor a { background: #5d4037; }
        .btn-xenia a { background: #1b5e20; }
        .btn-flora a { background: #00205b; color: #fe4f00 !important; }
        .btn-louisville a { background: #060404; color: #d61a21 !important; }

        /* --- 6. NEWS CARDS & TOWN COLORS --- */
        .glass-card { background: white; padding: 30px; margin-bottom: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border-top: 8px solid #333; position: relative; }
        
        /* Town Border Colors */
        .flora-card { border-top-color: #fe4f00 !important; }
        .louisville-card { border-top-color: #d61a21 !important; }
        .claycity-card { border-top-color: #0c30f0 !important; }
        .xenia-card { border-top-color: #1b5e20 !important; }
        .sailor-card { border-top-color: #5d4037 !important; }
        .general-card { border-top-color: #ccc !important; background: #f9f9f9; color: #000; }

        .read-more-btn { display: inline-block; margin-top: 15px; padding: 8px 20px; background: #333; color: #fff; text-decoration: none; border-radius: 5px; font-family: sans-serif; font-weight: bold; }
        
        /* --- 7. FUEL BOARD WIDGET --- */
        .fuel-board { width: 100%; max-width: 380px; margin: 20px auto; background: #121212; border: 1px solid #333; border-radius: 8px; overflow: hidden; color: white; }

        .content-section { display: none; }
        .content-section.active { display: block; }
    </style>
</head>
<body>

<div class="menu-wrapper">
    <div id="live-clock" style="text-align:center; font-family:sans-serif; font-weight:900; margin-bottom:10px;">00:00:00 PM</div>
    <ul class="city-nav">
        <li class="btn-claycity"><a href="https://supportmylocalcommunity.com/clay-city/">Clay City</a></li>
        <li class="btn-sailor"><a href="https://supportmylocalcommunity.com/sailor-springs/">Sailor Springs</a></li>
        <li class="btn-xenia"><a href="https://supportmylocalcommunity.com/xenia/">Xenia</a></li>
        <li class="btn-flora"><a href="https://ourflora.com/">Flora</a></li>
        <li class="btn-louisville"><a href="https://supportmylocalcommunity.com/louisville/">Louisville</a></li>
    </ul>
</div>

<div class="main-hub-container">
    <div id="news-archive" class="content-section active">
        <div id="news-container">üóûÔ∏è Loading News...</div>
    </div>
    <div id="calendar-archive" class="content-section">
        <div id="calendar"></div>
    </div>
</div>

<script>
    const newsJson = 'https://raw.githubusercontent.com/KFruti88/clay-county-news/main/news_data.json';
    const mainNewsCenter = "https://supportmylocalcommunity.com/clay-county-news-center/";

    // 1. URL PARSING (Detect if we are on a town site)
    const urlParams = new URLSearchParams(window.location.search);
    const filterTown = urlParams.get('town'); // Use ?town=flora in URL

    function getTownClass(town) {
        const t = town.toLowerCase();
        if (t.includes('flora')) return 'flora-card';
        if (t.includes('louisville')) return 'louisville-card';
        if (t.includes('clay city')) return 'claycity-card';
        if (t.includes('xenia')) return 'xenia-card';
        if (t.includes('sailor')) return 'sailor-card';
        return 'general-card';
    }

    // 2. LOAD NEWS WITH SMART FILTERING & BOOKMARKING
    fetch(newsJson).then(res => res.json()).then(data => {
        const container = document.getElementById('news-container');
        container.innerHTML = '';

        data.forEach(item => {
            const itemTown = item.town ? item.town.toLowerCase() : 'general';
            const townClass = getTownClass(itemTown);
            
            // SECURITY: Only show news for this town OR general news
            // If no filterTown is set (Master Page), show everything.
            if (!filterTown || itemTown === filterTown.toLowerCase() || itemTown === 'general') {
                
                const isFullStoryPage = window.location.href.includes("news-center");
                const storyContent = isFullStoryPage ? item.full_story : (item.summary || item.full_story.substring(0, 200) + "...");
                const readMoreLink = `${mainNewsCenter}#article-${item.id}`;

                container.innerHTML += `
                    <article class="glass-card ${townClass}" id="article-${item.id}">
                        <div style="font-weight:bold; color:#888; margin-bottom:10px;">${item.source} | ${item.date}</div>
                        <h2>${item.title}</h2>
                        <div style="font-family:Georgia; line-height:1.8; font-size:1.1rem;">${storyContent}</div>
                        ${!isFullStoryPage ? `<a href="${readMoreLink}" class="read-more-btn">Read Full Story</a>` : ''}
                    </article>`;
            }
        });

        // 3. BOOKMARK JUMP
        if(window.location.hash) {
            setTimeout(() => {
                const target = document.querySelector(window.location.hash);
                if(target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 500);
        }
    });

    // 4. LIVE CLOCK
    setInterval(() => {
        document.getElementById('live-clock').innerText = new Date().toLocaleTimeString();
    }, 1000);
</script>
</body>
</html>
